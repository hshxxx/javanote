# 1、应用开发的演变

```shell
1. java web 的mvc结构
2. spring mvc结构
3. spring boot 的约定大于配置
前三个阶段的开发遵循all in one的单机开发模式，应对高并发的成本过高。
4. 微服务架构；将系统拆分成多个模块，根据需要组合装配在分布式系统上，利用廉价的机器完成单个计算机无法完成的计算和存储任务，处理更多的数据。
微服务架构的4个核心问题：
	1.服务很多，客户端如何访问？
	2.服务很多，服务之间如何通信？
	3.服务很多，应该如何治理这些服务？
	4.服务挂了怎么办？
微服务的解决方案：
	1.spring cloud netflix 一站式解决方案
		api网关：zuul组件
		服务通信：feign 
		服务注册发现：Eureka
		熔断机制：Hystrix
	2.dubbo+zookeeper 半自动解决方案
    	api网关：没有；使用第三方组件或者自己实现
    	服务通信：dubbo 
		服务注册发现：zookeeper
		熔断机制：没有；Hystrix
	3.spring cloud alibaba 一站式解决方案，比Netflix更简单	
微服务核心如下，主要原因就是网络的不可靠性。
	api网关
	服务通信
	服务注册发现
	熔断机制

5.服务网格 server mesh

```





# 2、微服务

## 2.1 什么是微服务

[微服务概念提出者的论文](https://blog.csdn.net/qq_44358041/article/details/96483174)

就目前而言，对于微服务，业界并没有一个统一的标准定义。

但通常而言，微服务是一种架构模式或架构风格，它提倡将单一的应用程序划分成**一组小的服务**，每个服务运行在其独立的进程内，服务之间互相协调，互相配置，为用户提供最终价值。服务之间采用**轻量级的通信机制**互相沟通，每个服务都围绕着具体的业务进行构建，并且能够被独立的部署到生产环境中。另外，应尽量避免统一的，集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言和工具对其进行构建，可以有一个非常**轻量级的集中式管理来协调**这些服务，可以使用不同的语言来编写服务，也可以使用不同的数据库存储。

从技术的维度来讲，为服务的核心就是将传统的一站式应用，根据业务拆分成一个一个的服务，彻底的解耦合，每一个微服务提供单个业务功能的服务，一个服务做一件事情，从技术角度来看就是一种小而独立的处理过程，类似进程的概念。

## 2.2 微服务与微服务架构

**微服务**

​	强调的是服务的大小，一个微服务是专门解决某一个问题的一个服务应用，狭义的理解可以是idea中的一个个的module。

**微服务架构**

​	是一种架构模式，将一个单体服务拆分成一组微服务。

## 2.3 微服务的优缺点

**优点**

- 每个服务足够小，足够内聚，容易理解。
- 开发简单，一个微服务只专注于干一件事。
- 微服务能够被2到5人的小团队单独开发。
- 微服务是低耦合的，是有功能意义的服务，无论是在开发阶段还是部署阶段都是独立的。
- **微服务能使用不同的语言开发，不同的数据库存储。**
- 易于和第三方集成，微服务允许容易且灵活的方式集成自动部署，通过持续集成工具，如jenkins，Hudson，bamboo
- 微服务易于被一个开发人员理解，修改和维护，这样小团队可以更专注于自己的工作，降低沟通成本。
- 微服务允许你利用融合最新技术。
- **微服务只是业务逻辑代码，不会和HTML,CSS混合。**

**缺点**：

- 开发人员要处理分布式系统的复杂性
- 多服务的运维难度随着服务增多而增加，运维压力大。
- 系统部署依赖
- 服务间通信成本
- 数据一致性
- 系统集成测试
- 性能监控

## 2.4 微服务技术栈

| 微服务条目                             | 落地技术                                                    |
| -------------------------------------- | ----------------------------------------------------------- |
| 服务开发                               | SpringBoot、Spring、SpringMVC                               |
| 服务注册与发现                         | Eureka、Consul、Zookeeper等                                 |
| 服务调用                               | Rest、RPC、gRPC                                             |
| 服务熔断器                             | Hystrix、Envoy等                                            |
| 负载均衡                               | Ribbon、Nginx等                                             |
| 服务接口调用(客户端调用服务的简化工具) | Feign等                                                     |
| 消息队列                               | Kafka、RabbitMQ、ActiveMQ等                                 |
| 服务配置中心管理                       | SpringCloudConfig、Chef等                                   |
| 服务路由(API网关)                      | Zuul等                                                      |
| 服务监控                               | Zabbix、Nagios、Metrics、Spectator                          |
| 全链路追踪                             | Zipkin、Brave、Dapper等                                     |
| 服务部署                               | Docker、OpernStack、Kubernetes                              |
| 数据流操作开发包                       | SpringCloud Stream(封装与Redis,Rabbit,Kafaka等发送接收消息) |
| 事件消息总线                           | Spring Cloud Bus                                            |
|                                        |                                                             |

## 2.5 为什么选择springcloud

### 2.5.1 选型依据

微服务架构是不是只有springcloud一种落地的技术呢？不是。好比天上一个理念——卖汉堡，落地的是肯德基、麦当劳、德克士，同样为什么springcloud拔得头筹、浮出水面呢？一家大公司的架构师选择技术不是瞎选的，不是哪个新就用那个，比如有些公司还在用java6，因为它们是对商业负责，要的是稳定压倒一切，不见得最新最全的技术是最好的。是有一套依据的，
**选型依据**

1. 整体解决方案和框架成熟度
2. 社区热度
3. 可维护性
4. 学习曲线

### 2.5.2 各大IT公司用的微服务架构有那些

**阿里Dubbo/HSF**

阿里前面用的是Dubbo，后面很可惜dubbo从2012年开始停止更新了5年。因为梁飞团队被打散，梁飞Dubbo的主要负责人目前已经在天猫服务，其他人走的走散的散，Dubbo就停更了。2017年，阿里又重启了对Dubbo的维护，正因为停更5年，它睡大觉，给springcloud社区极好的不是趁虚而入的时间，5年呀5个月都会发生多少框架的改变，springcloud直接异军突起，之后dubbo能不能追上，不大明白，现在搞得我们java程序员很难受，如果Dubbo一直坚守，我们就不用学习springcloud了。但现在没办法，只好两个框架都学，到公司用springcloud还是dubbo你都能做。

梁飞团队被打散后，阿里用的是HSF(High Speed Framework)，分布式的高速框架，可以理解为第二代的Dubbo，江湖人称好舒服。阿里的很多框架都喜欢用首字母拼，比如TDDL数据库，江湖人称头都大了

**京东JSF**

阿里的人被京东挖了一堆，京东几乎是对标阿里的，这年头敢跟马爸爸叫板的是不是也就强哥大强子了。它们也要做一套分布式的服务治理框架，这个时候就是JD SF ，江湖人称京舒服。

**新浪微博Motan**

取名达摩魔毯，后来改名魔毯

**当当网DubboX**

不用说，也知道当当网当时是借鉴了阿里的Dubbo框架出了自己的DubboX，但是很可惜当当网的老大Lisa已经把当当网给卖了，所以在社区上当当网给DubboX的维护我个人是不看好，因为公司都被卖了。

有同行认为现在能够异军突起的，就是2017年Dubbo重启后的3.0和目前的springCloud之争。两个就好比华山派的剑宗和气宗之争，谁能胜出那么就要看二者大战结果了。

### 2.5.3 各微服务框架对比

为什么springcloud会脱颖而出？这个东西不是说背书依靠spring有强大的社区，怎么样怎么的就牛，不是这样滴，我们看下服务对比
一个微服务要满足很多种微服务的落地维度，是否支持Rest、支持RPC、负载均衡。。。要是一个好的微服务框架，就要满足这么多维度，第一看看你是否满足，第二看看如何满足，什么叫如何满足呢？第一种叫自力更生——满足这些微服务都是自己的东西，第二种叫借用第三方技术。我们收集了市面上的几个微服务框架，做了对比

| 功能点/服务框架 | Netflix/Spring cloud                                         | Motan                                                        | gRPC                      | Thrift   | Dubbo/DubboX             |
| --------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------- | -------- | ------------------------ |
| 功能定位        | 完整的微服务框架                                             | RPC框架，但整合了ZK或Consul，实现集群环境的基本的服务注册/发现 | RPC框架                   | RPC框架  | 服务框架                 |
| 支持Rest        | 是 Ribbon支持多种可插拔的序列化选择                          | 否                                                           | 否                        | 否       | 否                       |
| 支持RPC         | 否                                                           | 是(Hession2)                                                 | 是                        | 是       | 是                       |
| 支持多语言      | 是（Rest形式）                                               | 否                                                           | 是                        | 是       | 否                       |
| 服务的注册/发现 | 是(Eureka) Eureka服务注册表，Karyon服务端框架支持服务注册和健康检查 | 是(zookeeper/consul)                                         | 否                        | 否       | 是                       |
| 负载均衡        | 是(服务端zuul+客户端Ribbon) Zuul-服务，动态路由 云端负载均衡 Eureka(针对中间层服务器) | 是(客户端)                                                   | 否                        | 否       | 是(客户端)               |
| 配置服务        | Netflix Archaius Spring cloud Config Server 集中配置         | 是(zookeeper提供)                                            | 否                        | 否       | 否                       |
| 服务调用链监控  | 是(zuul）Zuul提供边缘服务，API网关                           | 否                                                           | 否                        | 否       | 否                       |
| 高可用/容错     | 是(服务端Hystrix+客户端Ribbon）                              | 是(客户端)                                                   | 否                        | 否       | 是(客户端)               |
| 典型应用案例    | Netflix                                                      | Sina                                                         | Google                    | Facebook |                          |
| 社区活跃度      | 高                                                           | 一般                                                         | 高                        | 一般     | 已经不维护了(2017年以前) |
| 学习难度        | 中等                                                         | 低                                                           | 高                        | 高       | 低                       |
| 文档丰富度      | 高                                                           | 一般                                                         | 一般                      | 一般     | 高                       |
| 其他            | Spring Cloud Bus为我们的应用程序带来了更多管理端点           | 支持降级                                                     | Netflix内部在开发集成gRPC | IDL定义  | 实践的公司比较多         |

说明：

1. 支持Rest维度，springcloud外其它几种都是否，为什呢？spring家族里前端springmvc干翻了struts2，大家都知道struts2因为安全漏洞的问题被各大IT公司所抛弃，连它自己都不用了，被前端用Rest springmvc来代替。
2. 我们主要将springcloud和dubbo做对比，就是为什么springcloud被选出来了。两句话，Dubbo睡觉睡了5年，这个东西人家springcloud可不是龟兔赛跑，springcloud可是猎豹，你睡了5年，那不会给你机会的。现在来说，老系统用dubbo的多，新系统用springcloud的多，在公司里上班，我个人觉得springcloud是一定要掌握的。
3. 落地微服务架构的技术维度，springcloud都几乎满足，所以springcloud牛不是吹牛皮的，不是背靠spring大背书，而是自身确确实实能够凭借一己之力满足微服务架构的技术维度要点。





# 3、springcloud

## 3.1 什么是springcloud

springcloud 结构图

 ![Spring Cloud diagram](https://spring.io/images/cloud-diagram-1a4cad7294b4452864b5ff57175dd983.svg)

-------------------

springcloud基于springboot提供了一套微服务解决方案，包括服务注册发现，配置中心，全链路监控，服务网关，负载均衡，熔断器等组件，除了基于Netflix的开源组件做高度抽象封装之外，还有一些选型中立的开源组件。

springcloud利用springboot的开发便利性，巧妙地简化了分布式系统基础设施的开发，springcloud为开发人员提供了快速构建分布式系统的一些工具，**包括配置管理，服务发现，断路器，路由，微代理，时间总线，全局锁，决策竞选，分布式会话等等**，他们都可以用springboot的开发风格做到一键启动和部署。

springboot并没有重复造轮子，他只是将目前各家公司开发的比较成熟，经得起实际考验的服务框架组合起来，通过springboot风格进行再封装，屏蔽掉了复杂的配置和实现原理，**最终给开发者留出了一套简单易懂，易部署和易维护的分布式系统开发工具包**。

springcloud是分布式微服务架构下的一站式解决方案，是**各个微服务架构落地技术的集合体**，俗称微服务全家桶。

## 3.2 springboot与springcloud区别

- springboot专注于快速，方便的开发单个个体微服务。

- springcloud是**关注全局的微服务协调整理治理框架**，它将springboot开发的一个个单体微服务整合并管理起来，并为各个微服务之间提供：配置管理，服务发现，断路器，路由，微代理，事件总线，全局锁，决策竞选，分布式会话等等集成服务。

- springboot可以离开springcloud独立使用，但springcloud离不开springboot。

  

## 3.3 dubbo 和 springcloud技术选型

### 1. 分布式+服务治理dubbo

目前成熟的互联网架构：应用服务化拆分+消息中间件

![image-20201221182259713](C:\Users\xpty\AppData\Roaming\Typora\typora-user-images\image-20201221182259713.png)



### 2. dubbo 和 springcloud对比

首先在社区活跃度上springcloud比dubbo要活跃得多。

两者的核心要素对比：

![img](https://img-blog.csdn.net/20171127161941661)

**最大区别**：springcloud抛弃了dubbo的rpc通信，采用基于http的rest方式。

严格来说，这两种方式各有优劣，虽然从一定程度上来说，后者牺牲了服务调用的性能，但也避免了原生rpc带来的问题。而且rest相比rpc更为灵活，服务提供方和调用方的依赖只依靠一纸契约，不存在代码级别的强依赖，这在强调快速演化的微服务环境下，显得更加合适。

**品牌机与组装机的区别**

很明显，springcloud的功能比dubbo更加强大，涵盖面更广，而且作为spring的拳头项目，它也能够与spring framework，springboot，springdata，spring batch等其他spring项目完美融合，这些对于微服务而言是至关重要的。使用dubbo构建的微服务架构就像组装电脑，各环节我们的选择自由度很高，但是最终结果很有可能因为某一个部件出错导致电脑启动不起来，让人不够放心。而springcloud就像是品牌机，在spring source的整合下，做了大量的兼容性测试，保证了机器拥有更高的稳定性，但是如果要在使用非spring组件外的东西时就需要对其基础有足够的了解。

**社区支持和更新力度**

dubbo从12年到17年都是停止更新的，对于技术发展的新需求，需要开发者自行升级，比如当当网的dubbox。大公司有升级dubbo的能力，但更多的小公司没有修改dubbo源码并适配一套保证稳定性的解决方案的能力。



## 3.4 版本对应关系

大版本对应：

| Spring Cloud             | Spring Boot                                    |
| ------------------------ | ---------------------------------------------- |
| Angel版本                | 兼容Spring Boot 1.2.x                          |
| Brixton版本              | 兼容Spring Boot 1.3.x，也兼容Spring Boot 1.4.x |
| Camden版本               | 兼容Spring Boot 1.4.x，也兼容Spring Boot 1.5.x |
| Dalston版本、Edgware版本 | 兼容Spring Boot 1.5.x，不兼容Spring Boot 2.0.x |
| Finchley版本             | 兼容Spring Boot 2.0.x，不兼容Spring Boot 1.5.x |
| Greenwich版本            | 兼容Spring Boot 2.1.x                          |
| Hoxtonl版本              | 兼容Spring Boot 2.2.x                          |

在实际开发过程中，我们需要更详细的版本对应：

| Spring Boot                  | Spring Cloud            |
| ---------------------------- | ----------------------- |
| 1.5.2.RELEASE                | Dalston.RC1             |
| 1.5.9.RELEASE                | Edgware.RELEASE         |
| 2.0.2.RELEASE                | Finchley.BUILD-SNAPSHOT |
| 2.0.3.RELEASE                | Finchley.RELEASE        |
| 2.1.0.RELEASE-2.1.14.RELEASE | Greenwich.SR5           |
| 2.2.0.M4                     | Hoxton.SR4              |